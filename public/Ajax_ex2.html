<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>초등학교 저학년 사칙연산 계산기</title>
</head>
<body>
  <h1>초등학교 저학년 사칙연산 계산기</h1>

  항1: <input type="text" id="a" value="10"><br>          <!-- 항1 숫자 입력 -->
  항2: <input type="text" id="b" value="3"><br>           <!-- 항2 숫자 입력 -->

  연산자:
  <select id="oper">
      <option value="plus">+</option>
      <option value="min">-</option>
      <option value="mult">*</option>
      <option value="div">/</option>
  </select>

  <button id="btn">확인</button>                                <!-- 계산 실행 버튼 -->

  <div>결과: <span id="result">-</span></div>               <!-- 결과 표시 영역 -->
  <div>상태: <span id="status">대기</span></div>             <!-- 상태 표시 영역 -->

  <script>
    // 시작 로그를 콘솔에 남깁니다.
    console.log("XMLHttpRequest Ajax 계산기 시작");

    // 백엔드 서버의 기본 URL을 정의합니다.
    var BASE_URL = "http://127.0.0.1:8000";

    // DOM에서 필요한 요소들을 가져와 변수에 저장합니다.
    var inputA = document.getElementById("a");        // 항1 입력 요소
    var inputB = document.getElementById("b");        // 항2 입력 요소
    var selectOper = document.getElementById("oper"); // 연산자 드롭다운
    var buttonBtn = document.getElementById("btn");   // 확인 버튼

    var resultSpan = document.getElementById("result"); // 결과 텍스트를 바꿀 요소
    var statusSpan = document.getElementById("status"); // 상태 텍스트를 바꿀 요소

    // 버튼 클릭 시 실행될 핸들러 등록
    buttonBtn.onclick = function () {
        // 입력값 읽어오기
        var a = inputA.value;
        var b = inputB.value;
        var oper = selectOper.value;

        console.log("버튼 눌렀다!", a, b, oper);

        // 숫자 검증: 문자열을 숫자로 변환
        // 1) .value: 입력 요소의 현재 값을 문자열로 얻는 메서드/속성
        var na = Number(a);
        var nb = Number(b);

        // 2) Number.isNaN: 주어진 값이 NaN인지 확인하는 메서드
        // NaN인 경우는 숫자가 아닙니다. 이를 걸러내고 오류를 표시합니다.
        if (Number.isNaN(na) || Number.isNaN(nb)) {
            statusSpan.textContent = "입력 오류";
            resultSpan.textContent = "숫자만 입력하세요.";
            return;
        }

        // 요청 URL 구성: 예) http://127.0.0.1:8000/plus/10/3
        var url = BASE_URL + "/" + oper + "/" + na + "/" + nb;
        console.log("요청 URL:", url);

        // XMLHttpRequest 객체 생성: Ajax 요청을 보낼 준비
        var xhr = new XMLHttpRequest();

        // GET 방식으로 비동기 요청을 보냄
        // 4) .open: XMLHttpRequest()의 메서드로 백엔드에 요청 정보를 설정
        //    - 첫 번째 인자: HTTP 메서드("GET" 등)
        //    - 두 번째 인자: 요청할 URL
        //    - 세 번째 인자: 비동기 여부(true/false)
        xhr.open("GET", url, true);

        // 응답 수신 완료 시 처리 로직
        xhr.onload = function () {
            // 5) .status: HTTP 응답 상태 코드. 200은 성공
            // 8) .responseText: 서버가 보낸 응답 본문(문자열)
            if (xhr.status === 200) {
                console.log("서버 응답:", xhr.responseText);
                resultSpan.textContent = xhr.responseText; // 서버의 계산 결과를 화면에 표시
                statusSpan.textContent = "성공";            // 상태를 성공으로 표시
            } else {
                // 서버가 에러를 응답한 경우
                console.error("서버 오류:", xhr.status);
                resultSpan.textContent = xhr.responseText;  // 서버가 보낸 에러 메시지 표시
                statusSpan.textContent = "오류 (" + xhr.status + ")"; // 상태에 코드 표시
            }
        };

        // 네트워크 오류가 발생했을 때 처리 로직
        xhr.onerror = function () {
            // 6) .error: 네트워크 오류 발생 시 실행되는 이벤트 핸들러
            statusSpan.textContent = "네트워크 오류"; // 네트워크 문제 알림
            resultSpan.textContent = "-";            // 결과를 초기화
        };

        // 요청 본문(body)은 GET의 경우 일반적으로 필요 없으므로 null 전달
        // 7) .send: 요청 데이터를 서버로 보냄. GET의 경우 보통 null
        xhr.send(null);
    };
  </script>
</body>
</html>
